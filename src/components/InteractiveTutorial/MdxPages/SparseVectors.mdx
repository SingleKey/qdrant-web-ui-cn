export const title = '稀疏向量';

# 稀疏向量搜索

在本教程中，您将学习如何在Qdrant中创建支持稀疏向量的集合，插入带稀疏向量的点，并根据特定索引和值进行查询。稀疏向量允许您高效地存储和搜索只有某些维度为非零的数据，这在文本嵌入或处理稀疏数据等应用中特别有用。

## 步骤1：创建支持稀疏向量的集合

第一步是创建一个可以处理稀疏向量的集合。与表示完整特征空间的密集向量不同，稀疏向量仅在选定位置存储非零值，使其更加高效。我们将创建一个名为`sparse_charts`的集合，其中每个点将具有稀疏向量来表示关键词或其他特征。

运行以下请求以创建集合：

```json withRunButton=true
PUT /collections/sparse_charts
{
    "sparse_vectors": {
        "keywords": {}
    }
}
```

### 解释：
- **`sparse_vectors`**：定义集合支持稀疏向量，在这种情况下，由"keywords"索引。这可以表示基于关键词的特征，其中只有某些索引（位置）具有非零值。

---

## 步骤2：插入带稀疏向量的数据点

集合准备就绪后，您可以插入带稀疏向量的点。每个点将包括：
- `indices`：向量空间中非零值的位置。
- `values`：这些位置对应的值，表示每个关键词或特征的重要性或权重。

运行以下请求以插入点：

```json withRunButton=true
PUT /collections/sparse_charts/points
{
    "points": [
        {
            "id": 1,
            "vector": {
                "keywords": {
                    "indices": [1, 42],
                    "values": [0.22, 0.8]
                }
            }
        },
        {
            "id": 2,
            "vector": {
                "keywords": {
                    "indices": [2, 35],
                    "values": [0.15, 0.65]
                }
            }
        },
        {
            "id": 3,
            "vector": {
                "keywords": {
                    "indices": [10, 42],
                    "values": [0.3, 0.5]
                }
            }
        },
        {
            "id": 4,
            "vector": {
                "keywords": {
                    "indices": [0, 3],
                    "values": [0.4, 0.3]
                }
            }
        },
        {
            "id": 5,
            "vector": {
                "keywords": {
                    "indices": [2, 4],
                    "values": [0.9, 0.8]
                }
            }
        }
    ]
}
```

### 解释：
- 每个点由其稀疏向量表示，使用特定的关键词索引和值定义。
- 例如，**点1**在位置`1`和`42`处分别具有稀疏向量值`0.22`和`0.8`。这些可以表示与这些位置相关联的关键词的相对重要性。

---

## 使用特定索引和值运行查询

此查询搜索在位置`[1, 42]`具有非零值且具有特定值`[0.22, 0.8]`的点。这是一个有针对性的查询，期望与这些索引和值有紧密匹配。

```json withRunButton=true
POST /collections/sparse_charts/points/query
{
    "query": {
        "indices": [1, 42],
        "values": [0.22, 0.8]
    },
    "using": "keywords"
}
```

**预期结果：** **点1**将是最佳匹配，因为其稀疏向量包含这些索引，可以最大化相似性度量。在这种情况下，这是点积计算。

---

## 分解评分机制

此查询搜索在位置`[0, 2, 4]`具有非零值且具有值`[0.4, 0.9, 0.8]`的点。这是一个更广泛的搜索，可能会返回具有重叠索引和相似值的多个匹配项。

```json withRunButton=true
POST /collections/sparse_charts/points/query
{
    "query": {
        "indices": [0, 2, 4],
        "values": [0.4, 0.9, 0.8]
    },
    "using": "keywords"
}
```
---

## 我们如何得到这个结果：

让我们假设**点4**和**点5**的稀疏向量如下：
- **点4**：`[0.4, 0, 0, 0, 0]`  （在索引0处与查询匹配，值为0.4）
- **点5**：`[0, 0, 0.9, 0, 0.8]`  （在索引2和4处与查询匹配，值为0.9和0.8）

点积将如下所示：
- **点4的点积**：
   - 查询：`[0.4, 0, 0.9, 0, 0.8]`
   - 点4：`[0.4, 0, 0, 0, 0]`
   - 点积：( 0.4 * 0.4 = 0.16 )

- **点5的点积**：
   - 查询：`[0.4, 0, 0.9, 0, 0.8]`
   - 点5：`[0, 0, 0.9, 0, 0.8]`
   - 点积：( 0.9 * 0.9 + 0.8 * 0.8 = 0.81 + 0.64 = 1.45 )

由于**点5**具有更高的点积分，它将被认为比**点4**更好的匹配。
